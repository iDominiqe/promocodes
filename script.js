// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
async function loadPromocodes() {
    try {
        const response = await fetch('promocodes.json');
        const data = await response.json();
        
        displayPromocodes(data);
        updateLastUpdated(data.last_updated);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:', error);
        document.getElementById('loading').innerHTML = 
            '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
function displayPromocodes(data) {
    const activeList = document.getElementById('active-list');
    const expiredList = document.getElementById('expired-list');
    const loading = document.getElementById('loading');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    loading.classList.add('hidden');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
    if (data.active && data.active.length > 0) {
        activeList.innerHTML = data.active.map(promo => `
            <div class="promo-card active">
                <div class="promo-header">
                    <h3>${promo.code}</h3>
                    <span class="status-badge">üî• –ê–∫—Ç–∏–≤–µ–Ω</span>
                </div>
                <div class="promo-code" onclick="copyCode('${promo.code}')">
                    ${promo.code}
                    <small>–∫–ª–∏–∫–Ω–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</small>
                </div>
                <p class="reward">${promo.reward}</p>
                <p class="description">${promo.description || ''}</p>
                <p class="expires">‚è∞ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${promo.expires}</p>
            </div>
        `).join('');
    } else {
        activeList.innerHTML = '<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</p>';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–µ–∫—à–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
    if (data.expired && data.expired.length > 0) {
        expiredList.innerHTML = data.expired.map(promo => `
            <div class="promo-card expired">
                <div class="promo-header">
                    <h3>${promo.code}</h3>
                    <span class="status-badge">‚è∞ –ò—Å—Ç–µ–∫</span>
                </div>
                <p class="reward">${promo.reward}</p>
                <p class="description">${promo.description || ''}</p>
            </div>
        `).join('');
    } else {
        expiredList.innerHTML = '<p>–ù–µ—Ç –∏—Å—Ç–µ–∫—à–∏—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</p>';
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
function updateLastUpdated(date) {
    const footer = document.querySelector('footer');
    footer.innerHTML += `<br><small>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${date}</small>`;
}

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
function copyCode(code) {
    navigator.clipboard.writeText(code).then(() => {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification(`–ö–æ–¥ "${code}" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!`);
    }).catch(err => {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
    });
}

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message) {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 1rem 2rem;
        border-radius: 5px;
        z-index: 1000;
        animation: slideIn 0.3s ease;
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    .status-badge {
        background: #10b981;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.8em;
    }
    
    .promo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .promo-code {
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .promo-code:hover {
        background-color: #374151 !important;
    }
`;
document.head.appendChild(style);

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadPromocodes);
